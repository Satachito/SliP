<!DOCTYPE HTML>
<html lang=zxx>
<title>The monster calculator.</title>
<style>
button, input, select, textarea {
;	font-family				: inherit
;	font-size				: 100%
}
html {
;	height					: 100%
}
body {
;	height					: 100%
;	margin					: 0
;	display					: grid
;	grid-template-rows		: auto 1fr auto
;	grid-template-columns	: auto 1fr auto
}
header {
;	grid-column				: 1 / 4
;	border-bottom			: 1px solid black
;	padding					: 6px
;	font-family				: fantasy
}
footer {
;	grid-column				: 1 / 4
;	border-top				: 1px solid black
;	padding					: 6px
;	font-family				: cursive
}
nav {
;	border-right			: 1px solid black
;	padding					: 6px
;	font-family				: monospace
;	overflow				: scroll
}
aside {
;	border-left				: 1px solid black
;	padding					: 6px
;	font-family				: monospace
;	overflow				: scroll
}
jp-split-h {
;	font-family				: monospace
;	font-size				: 12px
;	overflow				: scroll
}
jp-split-h > * {
;	background-color		: #ffe
}
textarea {
;	resize					: none
;	border					: none
}
#GUTTER {
;	background				: lightgrey
;	cursor					: col-resize
}
#RESULT {
;	padding					: 6px
}
.hw32 {
;	height					: 32px
;	width					: 32px
}
.hw16 {
;	padding					: 0
;	height					: 24px
;	width					: 20px
}
</style>

<header>The monster calculator.</header>

<nav>
	<input type=button style="height:32px; width:100%" value=CALCULATE	id=CALCULATE><br>
	<br>
	<input type=button class=hw32 value=7	id=KEY_7		>
	<input type=button class=hw32 value=8	id=KEY_8		>
	<input type=button class=hw32 value=9	id=KEY_9		>
	<input type=button class=hw32 value=÷	id=KEY_DIV		><br>
	<input type=button class=hw32 value=4	id=KEY_4		>
	<input type=button class=hw32 value=5	id=KEY_5		>
	<input type=button class=hw32 value=6	id=KEY_6		>
	<input type=button class=hw32 value=×	id=KEY_MUL		><br>
	<input type=button class=hw32 value=3	id=KEY_3		>
	<input type=button class=hw32 value=2	id=KEY_2		>
	<input type=button class=hw32 value=1	id=KEY_1		>
	<input type=button class=hw32 value=-	id=KEY_MINUS	><br>
	<input type=button class=hw32 value=0	id=KEY_0		>
	<input type=button class=hw32 value=.	id=KEY_PERIOD	>
	<input type=button class=hw32 value=⏎	id=KEY_RET		>
	<input type=button class=hw32 value=+	id=KEY_PLUS		><br>
	<input type=button class=hw32 value=(	id=KEY_OPEN		>
	<input type=button class=hw32 value=)	id=KEY_CLOSE	>
	<input type=button class=hw32 value=%	id=KEY_REMAIN	>
	<input type=button class=hw32 value=C	id=CLEAR		><br>
	<br>
	<input type=button style="height:32px; width:100%" value=SPACE id=KEY_SPACE><br>
	<br>
	<input type=button class=hw value=sin	id=KEY_SIN	>
	<input type=button class=hw value=cos	id=KEY_COS	>
	<input type=button class=hw value=tan	id=KEY_TAN	><br>
	<input type=button class=hw value=log	id=KEY_LOG	>
	<input type=button class=hw value=exp	id=KEY_EXP	>
	<input type=button class=hw value=pow	id=KEY_POW	><br>
	<br>
	<input type=button class=hw16 value=α	id=KEY_α	>
	<input type=button class=hw16 value=β	id=KEY_β	>
	<input type=button class=hw16 value=γ	id=KEY_γ	>
	<input type=button class=hw16 value=δ	id=KEY_δ	>
	<input type=button class=hw16 value=ε	id=KEY_ε	>
	<input type=button class=hw16 value=ζ	id=KEY_ζ	><br>
	<input type=button class=hw16 value=η	id=KEY_η	>
	<input type=button class=hw16 value=θ	id=KEY_θ	>
	<input type=button class=hw16 value=ι	id=KEY_ι	>
	<input type=button class=hw16 value=κ	id=KEY_κ	>
	<input type=button class=hw16 value=λ	id=KEY_λ	>
	<input type=button class=hw16 value=μ	id=KEY_μ	><br>
	<input type=button class=hw16 value=ν	id=KEY_ν	>
	<input type=button class=hw16 value=ξ	id=KEY_ξ	>
	<input type=button class=hw16 value=ο	id=KEY_ο	>
	<input type=button class=hw16 value=π	id=KEY_π	>
	<input type=button class=hw16 value=ρ	id=KEY_ρ	>
	<input type=button class=hw16 value=ς	id=KEY_ς	>
	<input type=button class=hw16 value=σ	id=KEY_σ	><br>
	<input type=button class=hw16 value=τ	id=KEY_τ	>
	<input type=button class=hw16 value=υ	id=KEY_υ	>
	<input type=button class=hw16 value=φ	id=KEY_φ	>
	<input type=button class=hw16 value=χ	id=KEY_χ	>
	<input type=button class=hw16 value=ψ	id=KEY_ψ	>
	<input type=button class=hw16 value=ω	id=KEY_ω	><br>
	<br>
	<div style="display: none">
		<input type=button class=hw16 value=Α	id=KEY_Α	>
		<input type=button class=hw16 value=Β	id=KEY_Β	>
		<input type=button class=hw16 value=Γ	id=KEY_Γ	>
		<input type=button class=hw16 value=Δ	id=KEY_Δ	>
		<input type=button class=hw16 value=Ε	id=KEY_Ε	>
		<input type=button class=hw16 value=Ζ	id=KEY_Ζ	><br>
		<input type=button class=hw16 value=Η	id=KEY_Η	>
		<input type=button class=hw16 value=Θ	id=KEY_Θ	>
		<input type=button class=hw16 value=Ι	id=KEY_Ι	>
		<input type=button class=hw16 value=Κ	id=KEY_Κ	>
		<input type=button class=hw16 value=Λ	id=KEY_Λ	>
		<input type=button class=hw16 value=Μ	id=KEY_Μ	><br>
		<input type=button class=hw16 value=Ν	id=KEY_Ν	>
		<input type=button class=hw16 value=Ξ	id=KEY_Ξ	>
		<input type=button class=hw16 value=Ο	id=KEY_Ο	>
		<input type=button class=hw16 value=Π	id=KEY_Π	>
		<input type=button class=hw16 value=Ρ	id=KEY_Ρ	>
		<input type=button class=hw16 value=Σ	id=KEY_Σ	><br>
		<input type=button class=hw16 value=Τ	id=KEY_Τ	>
		<input type=button class=hw16 value=Υ	id=KEY_Υ	>
		<input type=button class=hw16 value=Φ	id=KEY_Φ	>
		<input type=button class=hw16 value=Χ	id=KEY_Χ	>
		<input type=button class=hw16 value=Ψ	id=KEY_Ψ	>
		<input type=button class=hw16 value=Ω	id=KEY_Ω	><br>
		<br>
	</div>
	<input type=button class=hw16 value=·	id=KEY_DOT		>
	<input type=button class=hw16 value=¡	id=KEY_REV_EX	>
	<input type=button class=hw16 value=¿	id=KEY_REV_Q	>
	<input type=button class=hw16 value=¦	id=KEY_BRK_BAR	>
	<input type=button class=hw16 value=§	id=KEY_SECTION	>
	<input type=button class=hw16 value=¶	id=KEY_PILCROW	><br>
	<input type=button class=hw16 value=¤	id=KEY_CURRENCY	>
	<input type=button class=hw16 value=¬	id=KEY_NOT		>
	<input type=button class=hw16 value=«	id=KEY_OPEN_DA	>
	<input type=button class=hw16 value=»	id=KEY_CLOSE_DA	>
	<input type=button class=hw16 value=∈	id=KEY_MEM_OF	>
	<input type=button class=hw16 value=∋	id=KEY_INCLUDES	><br>
	<br>
</nav>

<jp-split-h grid-template="1fr 6px 1fr">
	<textarea id=SOURCE></textarea>
	<div id=GUTTER></div>
	<div id=RESULT style="overflow: scroll"></div>
</jp-split-h>

<aside>
	When INPUT<br>
	<label for=CONV_ASTERISK	><input type=checkbox id=CONV_ASTERISK	checked	> * -> ×		</label><br>
	<label for=CONV_SLASH		><input type=checkbox id=CONV_SLASH		checked	> / -> ÷		</label><br>
	<br>
	When CALCULATE<br>
	<label for=PROGRAM_MODE		><input type=checkbox id=PROGRAM_MODE			> Program mode	</label><br>
	<label for=CONV_X			><input type=checkbox id=CONV_X					> x,X -> ×		</label><br>
	<br>
	When OUTPUT<br>
	<label for=INCLUDE_SOURCE	><input type=checkbox id=INCLUDE_SOURCE	checked> Include source	</label><br>
	<br>
</aside>

<footer>Copyright 2022 SliP LLC, Tokyo.</footer>

<script type=module>
import { NewContext, StringReader, Read, Eval, Sugared } from './SliP.js'

const
InsertToSOURCE = _ => {
	const $ = SOURCE.selectionStart
	SOURCE.value = SOURCE.value.substring( 0, $ ) + _ + SOURCE.value.substring( SOURCE.selectionEnd )
	setTimeout( () => SOURCE.selectionStart = SOURCE.selectionEnd = $ + _.length )
	SOURCE.focus()
}

KEY_0		.onclick = () => InsertToSOURCE( '0' )
KEY_1		.onclick = () => InsertToSOURCE( '1' )
KEY_2		.onclick = () => InsertToSOURCE( '2' )
KEY_3		.onclick = () => InsertToSOURCE( '3' )
KEY_4		.onclick = () => InsertToSOURCE( '4' )
KEY_5		.onclick = () => InsertToSOURCE( '5' )
KEY_6		.onclick = () => InsertToSOURCE( '6' )
KEY_7		.onclick = () => InsertToSOURCE( '7' )
KEY_8		.onclick = () => InsertToSOURCE( '8' )
KEY_9		.onclick = () => InsertToSOURCE( '9' )
KEY_DIV		.onclick = () => InsertToSOURCE( '÷' )
KEY_MUL		.onclick = () => InsertToSOURCE( '×' )
KEY_MINUS	.onclick = () => InsertToSOURCE( '-' )
KEY_PLUS	.onclick = () => InsertToSOURCE( '+' )
KEY_PERIOD	.onclick = () => InsertToSOURCE( '.' )
KEY_RET		.onclick = () => InsertToSOURCE( '\n' )
KEY_OPEN	.onclick = () => InsertToSOURCE( '(' )
KEY_CLOSE	.onclick = () => InsertToSOURCE( ')' )
KEY_REMAIN	.onclick = () => InsertToSOURCE( '%' )
KEY_SPACE	.onclick = () => InsertToSOURCE( ' ' )

KEY_SIN		.onclick = () => InsertToSOURCE( 'sin()' )
KEY_COS		.onclick = () => InsertToSOURCE( 'cos()' )
KEY_TAN		.onclick = () => InsertToSOURCE( 'tan()' )
KEY_EXP		.onclick = () => InsertToSOURCE( 'exp()' )
KEY_LOG		.onclick = () => InsertToSOURCE( 'log()' )
KEY_POW		.onclick = () => InsertToSOURCE( 'pow[]' )

KEY_DOT		.onclick = () => InsertToSOURCE( '·' )
KEY_REV_EX	.onclick = () => InsertToSOURCE( '¡' )
KEY_REV_Q	.onclick = () => InsertToSOURCE( '¿' )
KEY_BRK_BAR	.onclick = () => InsertToSOURCE( '¦' )
KEY_SECTION	.onclick = () => InsertToSOURCE( '§' )
KEY_NOT		.onclick = () => InsertToSOURCE( '¬' )
KEY_OPEN_DA	.onclick = () => InsertToSOURCE( '«' )
KEY_CLOSE_DA.onclick = () => InsertToSOURCE( '»' )
KEY_MEM_OF	.onclick = () => InsertToSOURCE( '∈' )
KEY_INCLUDES.onclick = () => InsertToSOURCE( '∋' )
KEY_PILCROW	.onclick = () => InsertToSOURCE( '¶' )
KEY_CURRENCY.onclick = () => InsertToSOURCE( '¤' )

KEY_Α		.onclick = () => InsertToSOURCE( 'Α' )
KEY_Β		.onclick = () => InsertToSOURCE( 'Β' )
KEY_Γ		.onclick = () => InsertToSOURCE( 'Γ' )
KEY_Δ		.onclick = () => InsertToSOURCE( 'Δ' )
KEY_Ε		.onclick = () => InsertToSOURCE( 'Ε' )
KEY_Ζ		.onclick = () => InsertToSOURCE( 'Ζ' )
KEY_Η		.onclick = () => InsertToSOURCE( 'Η' )
KEY_Θ		.onclick = () => InsertToSOURCE( 'Θ' )
KEY_Ι		.onclick = () => InsertToSOURCE( 'Ι' )
KEY_Κ		.onclick = () => InsertToSOURCE( 'Κ' )
KEY_Λ		.onclick = () => InsertToSOURCE( 'Λ' )
KEY_Μ		.onclick = () => InsertToSOURCE( 'Μ' )
KEY_Ν		.onclick = () => InsertToSOURCE( 'Ν' )
KEY_Ξ		.onclick = () => InsertToSOURCE( 'Ξ' )
KEY_Ο		.onclick = () => InsertToSOURCE( 'Ο' )
KEY_Π		.onclick = () => InsertToSOURCE( 'Π' )
KEY_Ρ		.onclick = () => InsertToSOURCE( 'Ρ' )
KEY_Σ		.onclick = () => InsertToSOURCE( 'Σ' )
KEY_Τ		.onclick = () => InsertToSOURCE( 'Τ' )
KEY_Υ		.onclick = () => InsertToSOURCE( 'Υ' )
KEY_Φ		.onclick = () => InsertToSOURCE( 'Φ' )
KEY_Χ		.onclick = () => InsertToSOURCE( 'Χ' )
KEY_Ψ		.onclick = () => InsertToSOURCE( 'Ψ' )
KEY_Ω		.onclick = () => InsertToSOURCE( 'Ω' )
KEY_α		.onclick = () => InsertToSOURCE( 'α' )
KEY_β		.onclick = () => InsertToSOURCE( 'β' )
KEY_γ		.onclick = () => InsertToSOURCE( 'γ' )
KEY_δ		.onclick = () => InsertToSOURCE( 'δ' )
KEY_ε		.onclick = () => InsertToSOURCE( 'ε' )
KEY_ζ		.onclick = () => InsertToSOURCE( 'ζ' )
KEY_η		.onclick = () => InsertToSOURCE( 'η' )
KEY_θ		.onclick = () => InsertToSOURCE( 'θ' )
KEY_ι		.onclick = () => InsertToSOURCE( 'ι' )
KEY_κ		.onclick = () => InsertToSOURCE( 'κ' )
KEY_λ		.onclick = () => InsertToSOURCE( 'λ' )
KEY_μ		.onclick = () => InsertToSOURCE( 'μ' )
KEY_ν		.onclick = () => InsertToSOURCE( 'ν' )
KEY_ξ		.onclick = () => InsertToSOURCE( 'ξ' )
KEY_ο		.onclick = () => InsertToSOURCE( 'ο' )
KEY_π		.onclick = () => InsertToSOURCE( 'π' )
KEY_ρ		.onclick = () => InsertToSOURCE( 'ρ' )
KEY_ς		.onclick = () => InsertToSOURCE( 'ς' )
KEY_σ		.onclick = () => InsertToSOURCE( 'σ' )
KEY_τ		.onclick = () => InsertToSOURCE( 'τ' )
KEY_υ		.onclick = () => InsertToSOURCE( 'υ' )
KEY_φ		.onclick = () => InsertToSOURCE( 'φ' )
KEY_χ		.onclick = () => InsertToSOURCE( 'χ' )
KEY_ψ		.onclick = () => InsertToSOURCE( 'ψ' )
KEY_ω		.onclick = () => InsertToSOURCE( 'ω' )
KEY_Α		.onclick = () => InsertToSOURCE( 'Α' )

SOURCE.onkeydown = ev => {
	if ( ev.metaKey ) return
	switch ( ev.key ) {
	case '*':
		CONV_ASTERISK.checked && (
			ev.preventDefault()
		,	InsertToSOURCE( '×' )
		)
		break
	case '/':
		CONV_SLASH.checked && (
			ev.preventDefault()
		,	InsertToSOURCE( '÷' )
		)
		break
	}
}

CLEAR.onclick = () => SOURCE.value = ''

const
AppendDIV = text => {
	const $ = RESULT.appendChild( document.createElement( 'div' ) )
	$.textContent = text
	return $
}

CALCULATE.onclick = () => {

	const c = NewContext()

	RESULT.textContent = ''

	let source = SOURCE.value
	CONV_X.checked && ( source = SOURCE.value.replaceAll( /[xX]/, '×' ) )
//	CONV_PLUS.checked && ( source = SOURCE.value.replaceAll( /＋/, '+' ) )
//	CONV_MINUS.checked && ( source = SOURCE.value.replaceAll( /－/, '-' ) )

	if ( PROGRAM_MODE.checked ) {
		const $ = new StringReader( source )
		while ( true ) {
			const start = $._
			const _ = Read( $ )
			if ( !_ ) break
			INCLUDE_SOURCE.checked && ( AppendDIV( SOURCE.value.substring( start, $._ ) ).style.color = 'grey' )
			try {
				AppendDIV( Eval( c, _ ).string() )
			} catch ( ex ) {
				ex.forEach( _ => AppendDIV( _ ).style.color = 'red' )
			}
		}
	} else {
		const lines = source.split( '\n' )
		lines.map(
			_ => {
				INCLUDE_SOURCE.checked && (
					_.length
					?	( AppendDIV( _ ).style.color = 'grey' )
					:	RESULT.appendChild( document.createElement( 'br' ) )
				)
				const index = _.indexOf( '//' )
				const $ = ( index < 0 ? _ : _.substring( 0, index ) ).trim()
				if ( $.length ) {
					try {
						AppendDIV( Eval( c, Sugared( _ ) ).string() )
					} catch ( ex ) {
						Array.isArray( ex )
						?	ex.forEach( _ => AppendDIV( _ ).style.color = 'red' )
						:	AppendDIV( ex ).style.color = 'red'
					}
				}
			}
		)
	}
}

window.onbeforeunload = () => localStorage.setItem( 'SOURCE', SOURCE.value )

window.onload = () => SOURCE.value = localStorage.getItem( 'SOURCE' )

</script>

<script src=./jp-split/jp-split.js></script>

