<style> 
body {
;	margin				: 0px
;	display				: grid
;	grid-template-rows	: 1fr auto
}
main {
;	overflow			: scroll
}
footer {
;	color				: white
}
</style> 

<main id=MAIN>
	<canvas id=CANVAS></canvas>
</main>
<footer>
	<label style="margin-left: 16px">Iterations</label><input id="ITERATIONS" type="range" min="2" max="1000" value="100" step="1" >
	<input id=REDRAW type=button value=Redraw>
</footer>

<script>

let iterations	= Number( ITERATIONS.value )

let	rMin		= -2
let	rMax		= 1
let	iMin		= -1
let	iMax		= 1

CANVAS.onmousedown = md => {
	const _rMin = rMin
	const _rMax = rMax
	const _iMin = iMin
	const _iMax = iMax
	const bR = ( rMax - rMin ) / CANVAS.width
	const bI = ( iMax - iMin ) / CANVAS.height
	CANVAS.onmousemove	= _ => {
		const dX = _.clientX - md.clientX
		const dY = _.clientY - md.clientY
		if ( dX ) {
			const _ = bR * dX
			rMin = _rMin - _
			rMax = _rMax - _
		}
		if ( dY ) {
			const _ = bI * dY
			iMin = _iMin + _
			iMax = _iMax + _
		}
		Draw()
	}
	CANVAS.onmouseleave = _ => CANVAS.onmousemove = CANVAS.onmouseleave = CANVAS.onmouseup = null
	CANVAS.onmouseup		= _ => {
		CANVAS.onmouseleave()
		if ( _.clientX === md.clientX && _.clientY === md.clientY ) {

			const r = rMin + bR * _.clientX;
			const rRange = ( rMax - rMin ) / 2;
			const bR2 = bR / 2;
			rMin = r - bR2 * _.clientX;
			rMax = rMin + rRange;

			const i = iMin + bI * ( CANVAS.height - 1 - _.clientY );
			const iRange = ( iMax - iMin ) / 2;
			const bI2 = bI / 2;
			iMin = i - bI2 * _.clientY;
			iMax = iMin + iRange;

			Draw();
		}
	}
}

const minLocation			= gl.getUniformLocation( program, 'min'			)
const maxLocation			= gl.getUniformLocation( program, 'max'			)
const resolutionLocation	= gl.getUniformLocation( program, 'resolution'	)
const iterationLocation		= gl.getUniformLocation( program, 'iterations'	)

const
Draw = () => {

	gl.viewport( 0, 0, CANVAS.width, CANVAS.height )

	gl.clear( gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT )

	gl.useProgram( program )

	gl.uniform2f( minLocation			, rMin, iMin )
	gl.uniform2f( maxLocation			, rMax, iMax )
	gl.uniform2f( resolutionLocation	, CANVAS.width, CANVAS.height )
	gl.uniform1i( iterationLocation		, iterations )

	let
	vertex_position

	gl.bindBuffer				( gl.ARRAY_BUFFER, buffer )
	gl.vertexAttribPointer		( vertex_position, 2, gl.FLOAT, false, 0, 0 )
	gl.enableVertexAttribArray	( vertex_position )
	gl.drawArrays				( gl.TRIANGLES, 0, 6 )
	gl.disableVertexAttribArray	( vertex_position )
}

const
Redraw = () => (
	CANVAS.width	= MAIN.clientWidth
,	CANVAS.height	= MAIN.clientHeight
,	Draw()
)

ITERATIONS.oninput = () => (
	iterations = Number( ITERATIONS.value )
,	Draw()
)

REDRAW.onclick = Redraw

onload = Redraw

/*
const
animate = () => (
	SyncDraw()
,	requestAnimationFrame( animate )
)
animate()
*/
</script> 

